; VovkPLCRuntime WCET Calibration Tester
;
; This PlatformIO project builds calibration firmware for various targets.
; The firmware runs opcode benchmarks and exposes timing results via the
; VovkPLC Serial API (marker memory reads).
;
; Usage:
;   From repository root: npm run calibrate
;   From this directory:  node ../../calibrate.js
;
; Each environment defines a target MCU. The calibration runner will:
;   1. Build the selected environment
;   2. Upload to the connected device
;   3. Connect via serial
;   4. Upload calibration bytecode samples
;   5. Read cycle times from marker memory
;   6. Output per-opcode timing results

[env]
lib_deps = https://github.com/Jozo132/VovkPLCRuntime
build_flags = -D __RUNTIME_PRODUCTION__ -D PLCRUNTIME_CALIBRATION_MODE
framework = arduino

; ============================================================================
; AVR (8-bit)
; ============================================================================

[env:avr_uno_16mhz]
platform = atmelavr
board = uno
monitor_speed = 115200
build_flags = ${env.build_flags}

[env:avr_nano_16mhz]
platform = atmelavr
board = nanoatmega328
monitor_speed = 115200
build_flags = ${env.build_flags}

; ============================================================================
; STM32 (Cortex-M)
; ============================================================================

[env:stm32f103_bluepill_72mhz]
platform = ststm32
board = genericSTM32F103C8
debug_tool = stlink
upload_protocol = stlink
monitor_speed = 115200
build_flags = ${env.build_flags} -D LED_BUILTIN=PC13
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
   -D USBCON
   -D USBD_VID=0x0483
   -D USBD_PID=0x5740
   -D USB_MANUFACTURER="Unknown"
   -D USB_PRODUCT="\"BLUEPILL_F103C8\""
   -D HAL_PCD_MODULE_ENABLED

[env:stm32f401_blackpill_84mhz]
platform = ststm32
board = genericSTM32F401RC
debug_tool = stlink
upload_protocol = dfu
monitor_speed = 115200
build_flags = ${env.build_flags}
   -D LED_BUILTIN=PC13
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
   -D USBCON
   -D USBD_VID=0x0483
   -D USBD_PID=0x5740
   -D USB_MANUFACTURER="STMicroelectronics"
   -D USB_PRODUCT="\"STM32 F401\""
   -D HAL_PCD_MODULE_ENABLED

[env:stm32f411_blackpill_100mhz]
platform = ststm32
board = blackpill_f411ce
debug_tool = stlink
upload_protocol = dfu
monitor_speed = 115200
build_flags = ${env.build_flags}
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
   -D USBCON
   -D USBD_VID=0x0483
   -D USBD_PID=0x5740
   -D USB_MANUFACTURER="STMicroelectronics"
   -D USB_PRODUCT="\"STM32 F411\""
   -D HAL_PCD_MODULE_ENABLED

[env:stm32h743_devebox_480mhz]
platform = ststm32
board = devebox_h743vitx
board_build.mcu = stm32h743vit6
debug_tool = stlink
upload_protocol = dfu
monitor_speed = 115200
build_flags = ${env.build_flags} -D LED_BUILTIN=PE3 -D BUTTON_BUILTIN=PC13
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
   -D USBCON
   -D USBD_VID=0x0483
   -D USBD_PID=0x5740
   -D USB_MANUFACTURER="STMicroelectronics"
   -D USB_PRODUCT="\"STM32 H743\""
   -D HAL_PCD_MODULE_ENABLED

[env:stm32g431_blackpill_170mhz]
platform = ststm32
board = genericSTM32G431CB
debug_tool = stlink
upload_protocol = dfu
monitor_speed = 115200
build_flags = ${env.build_flags} -D LED_BUILTIN=PC6 -D BUTTON_BUILTIN=PC13
   -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC

; ============================================================================
; ESP32 (Xtensa / RISC-V)
; ============================================================================

[env:esp32_wemos_240mhz]
platform = espressif32
board = wemos_d1_mini32
monitor_speed = 115200
build_flags = ${env.build_flags} -fexceptions

[env:esp32c3_supermini_160mhz]
platform = espressif32
board = lolin_c3_mini
monitor_speed = 115200
build_flags = ${env.build_flags} -fexceptions

[env:esp32s3_zero_240mhz]
platform = espressif32
board = adafruit_feather_esp32s3
monitor_speed = 115200
build_flags = ${env.build_flags} -fexceptions -DARDUINO_USB_CDC_ON_BOOT=1 -DBOARD_HAS_PSRAM=1
board_upload.flash_size = 4MB

; ============================================================================
; ESP8266 (Xtensa LX106)
; ============================================================================

[env:esp8266_d1mini_80mhz]
platform = espressif8266
board = d1_mini
monitor_speed = 115200
build_flags = ${env.build_flags} -fexceptions
board_build.flash_mode = dio

; ============================================================================
; RP2040 / RP2350 (ARM Cortex-M0+ / Cortex-M33)
; ============================================================================

[env:rp2040_pico_133mhz]
platform = raspberrypi
board = pico
upload_protocol = picotool
monitor_speed = 115200
build_flags = ${env.build_flags}

[env:rp2350_pico2_150mhz]
platform = raspberrypi
board = pimoroni_pico_plus_2
upload_protocol = picotool
monitor_speed = 115200
build_flags = ${env.build_flags}

; ============================================================================
; Renesas RA (Cortex-M4)
; ============================================================================

[env:ra4m1_uno_r4_48mhz]
platform = renesas-ra
board = uno_r4_minima
board_build.mcu = ra4m1
upload_protocol = dfu
monitor_speed = 115200
build_flags = ${env.build_flags}

; ============================================================================
; Nordic nRF52 (Cortex-M4F)
; ============================================================================

[env:nrf52840_nicenano_64mhz]
lib_deps = https://github.com/adafruit/Adafruit_nRF52_Arduino
platform = nordicnrf52
board = nicenano
upload_protocol = nrfutil
monitor_speed = 115200
build_flags = ${env.build_flags}
